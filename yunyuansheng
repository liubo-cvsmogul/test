ç›®å½•

ğŸ’æŸ¥çœ‹dockerç½‘ç»œ

ğŸ’bridgeç½‘ç»œ

ğŸ’noneç½‘ç»œ

ğŸ’hostç½‘ç»œ

ğŸ’è‡ªå®šä¹‰å®¹å™¨ç½‘ç»œ

    ğŸ¦åšå®¢ä¸»é¡µï¼šå¤§è™¾å¥½åƒå—çš„åšå®¢

    ğŸ¦ä¸“æ åœ°å€ï¼šäº‘åŸç”Ÿä¸“æ 

        æ ¹æ®å‰é¢çš„å­¦ä¹ ï¼Œå·²ç»å¯¹dockeræœ‰äº†ä¸€äº›ç®€å•çš„æ¦‚å¿µã€‚è¿™é‡Œåœ¨å•°å—¦ä¸€å¥ï¼Œå®¹å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå°å‹çš„linuxç³»ç»Ÿï¼ˆä½†ä¸è¦æŠŠå®ƒå½“çœŸæ­£çš„ç³»ç»Ÿï¼‰ï¼Œè€Œdockerçš„ç½‘ç»œåˆ†ä¸ºä¸‰ç§åˆ†åˆ«ä¸ºbridgeã€hostã€noneã€‚

bridgeï¼šé»˜è®¤ç½‘ç»œï¼Œå¯ä»¥pingé€šå¤–ç½‘ï¼Œä½†æ˜¯å¤–ç½‘æ— æ³•è®¿é—®å†…ç½‘ã€‚

hostï¼šè·Ÿæœ¬åœ°ä¸»æœºhostä½¿ç”¨çš„åŒä¸€ä¸ªç½‘ç»œã€‚

noneï¼šæ²¡æœ‰ç½‘ç»œï¼ŒæŒ‚è½½ç½‘ç»œä¸‹çš„å®¹å™¨é™¤äº†loï¼Œæ²¡æœ‰å…¶ä»–ç½‘å¡ã€‚

æŸ¥çœ‹dockerç½‘ç»œ
dockerå®‰è£…æ—¶ä¼šè‡ªåŠ¨åœ¨ç½‘ç»œä¸­åˆ›å»ºä¸‰ä¸ªç½‘ç»œï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼Œé»˜è®¤ç½‘ç»œæ˜¯bridgeã€‚

[root@doc11 ~]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
7d96a5075951   bridge    bridge    local
32cea9efbc61   host      host      local
4341e5f3526d   none      null      local
bridgeç½‘ç»œ
        dockerå®‰è£…çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºdocker0çš„linux bridgeã€‚å¦‚æœä¸æŒ‡å®šnetworkï¼Œåˆ›å»ºå®¹å™¨é»˜è®¤éƒ½æŒ‚åœ¨docker0ä¸Šã€‚

[root@doc11 ~]# brctl show
bridge name     bridge id               STP enabled     interfaces
docker0         8000.0242c661a50d       no
        å½“docker0ä¸Šæ²¡æœ‰ä»»ä½•ç½‘ç»œè®¾å¤‡ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¹å™¨çœ‹çœ‹æœ‰ä»€ä¹ˆå˜åŒ–ã€‚è¿™é‡Œä»¥httpdä¸ºä¾‹ï¼Œæ²¡æœ‰é•œåƒçš„è¯ä½¿ç”¨docker pull httpdä¸‹è½½ä¸€ä¸ªã€‚

[root@doc11 ~]# docker run -d httpd
dbd6e608e12332df931f8b010e8ea0c2404856d06b24c500bbf1bd551e590a70
[root@doc11 ~]# brctl show
bridge name     bridge id               STP enabled     interfaces
docker0         8000.0242c661a50d       no              vethd3c5074
        é€šè¿‡ä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæ–°çš„ç½‘ç»œæ¥å£vethd3c5074è¢«æŒ‚åˆ°äº†docker0ä¸Šï¼Œvethd3c5074å°±æ˜¯æ–°åˆ›å»ºå®¹å™¨çš„è™šæ‹Ÿç½‘å¡ã€‚

noneç½‘ç»œ
        æˆ‘ä»¬çœ‹ä¸€ä¸‹noneç½‘ç»œï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå®Œå…¨éš”ç¦»çš„ç½‘ç»œã€‚å¯¹äºå®‰å…¨æ€§è¦æ±‚é«˜ä¸”ä¸éœ€è¦è”ç½‘çš„åº”ç”¨å¯ä»¥ä½¿ç”¨noneç½‘ç»œï¼Œæ¯”å¦‚æŸä¸ªå®¹å™¨çš„å”¯ä¸€ç”¨é€”å°±æ˜¯ç”Ÿæˆéšæœºå¯†ç ï¼Œå°±å¯ä»¥æ”¾åˆ°noneç½‘ç»œä¸­é¿å…å¯†ç è¢«çªƒå–ã€‚

[root@doc11 ~]# docker run -it --network=none busybox
/ # ifconfig 
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
â€‹
/ # 
hostç½‘ç»œ
        è¿æ¥åˆ°hostç½‘ç»œçš„å®¹å™¨å…±äº«docker hostçš„ç½‘ç»œï¼Œå®¹å™¨çš„ç½‘ç»œé…ç½®ä¸hostå®Œå…¨ä¸€æ ·ã€‚å®¹å™¨ä¸­å¯ä»¥çœ‹åˆ°hostçš„æ‰€æœ‰ç½‘å¡ï¼Œhostnameä¹Ÿæ˜¯hostçš„ã€‚

[root@doc11 ~]# docker run -it --network=host busybox
/ # ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    link/ether 00:0c:29:74:01:52 brd ff:ff:ff:ff:ff:ff
    inet 192.168.8.11/24 brd 192.168.8.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::62ba:6b5b:2f04:4aef/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue 
    link/ether 02:42:c6:61:a5:0d brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:c6ff:fe61:a50d/64 scope link 
       valid_lft forever preferred_lft forever
/ # hostname
doc11
/ # 

é‚£ä¹ˆhostç½‘ç»œçš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

        ç›´æ¥ä½¿ç”¨hostçš„ç½‘ç»œæœ€å¤§çš„å¥½å¤„å°±æ˜¯æ€§èƒ½ï¼Œå¦‚æœå®¹å™¨å¯¹ç½‘ç»œä¼ è¾“æ•ˆç‡æœ‰è¾ƒé«˜çš„è¦æ±‚ï¼Œå¯ä»¥é€‰æ‹©hostç½‘ç»œã€‚å½“ç„¶ä¹Ÿæ˜¯æœ‰ä¸€äº›ç¼ºç‚¹çš„ï¼Œæ¯”å¦‚è¦è€ƒè™‘ç«¯å£å†²çªé—®é¢˜ï¼Œå¦‚æœhostä¸Šå·²ç»ä½¿ç”¨çš„ç«¯å£ï¼Œå®¹å™¨å†…å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚

è‡ªå®šä¹‰å®¹å™¨ç½‘ç»œ
        é™¤äº†ä¸Šé¢ä¸‰ç§ç½‘ç»œï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ ¹æ®ä¹Ÿæ— éœ€æ±‚åˆ›å»ºuser-definedç½‘ç»œã€‚dockeræä¾›äº†ä¸‰ç§user-definedç½‘ç»œé©±åŠ¨ ï¼šbridge,overlayå’Œmacvlanã€‚overlayå’Œmacvlanç”¨äºåˆ›å»ºè·¨ä¸»æœºç½‘ç»œã€‚

æˆ‘ä»¬é€šè¿‡bridgeé©±åŠ¨åˆ›å»ºç±»ä¼¼bridgeç½‘ç»œã€‚

[root@doc11 ~]# docker network create --driver bridge my_net
ce55c3cfefb5138572dcf58a8a1a81805415543b69893f2899ba37f18c2641fb
[root@doc11 ~]# brctl show
bridge name     bridge id               STP enabled     interfaces
br-ce55c3cfefb5         8000.0242c21d4aba       no
docker0         8000.0242c661a50d       no
        æ–°å¢ä¸€ä¸ªç½‘æ¡¥br-ce55c3cfefb5ï¼Œè¿™é‡Œbr-ce55c3cfefb5æ­£å¥½æ–°å»ºbridgeç½‘ç»œmy_netçš„çŸ­idã€‚ä¸‹é¢å‘½ä»¤æŸ¥çœ‹my_netçš„é…ç½®ä¿¡æ¯ã€‚

[root@doc11 ~]# docker network inspect my_net
[
    {
        "Name": "my_net",
        "Id": "ce55c3cfefb5138572dcf58a8a1a81805415543b69893f2899ba37f18c2641fb",
        "Created": "2023-06-19T02:46:15.02356553-04:00",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.18.0.0/16",
                    "Gateway": "172.18.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {},
        "Labels": {}
    }
]

ä¸Šè¿°172.18.0.0/16æ˜¯dockerè‡ªåŠ¨åˆ†é…çš„IPç½‘æ®µï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æŒ‡å®šç½‘æ®µã€‚

åªéœ€è¦åˆ›å»ºçš„æ—¶å€™æŒ‡å®š--subnetå’Œ--gatewayå‚æ•°

[root@doc11 ~]# docker network create --driver bridge --subnet 172.66.66.0/24 --gateway 172.66.66.1 my_net2
0f463941f2aa09619d41ccde1adb96a04af9228851c7c6eea5ddd0c24b54700b
[root@doc11 ~]# docker network inspect my_net2
[
    {
        "Name": "my_net2",
        "Id": "0f463941f2aa09619d41ccde1adb96a04af9228851c7c6eea5ddd0c24b54700b",
        "Created": "2023-06-19T02:50:57.224944386-04:00",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.66.66.0/24",
                    "Gateway": "172.66.66.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {},
        "Labels": {}
    }
]

        ä¸Šé¢æ–°å»ºçš„bridgeç½‘ç»œmy_net2ï¼Œç½‘æ®µä¸º172.66.66.0/24ï¼Œç½‘å…³ä¸º172.66.66.1ï¼Œç½‘å…³åœ¨my_net2å¯¹åº”çš„ç½‘æ¡¥br-0f463941f2aaä¸Šé¢ã€‚

[root@doc11 ~]# brctl show
bridge name     bridge id               STP enabled     interfaces
br-0f463941f2aa         8000.02426b2b8eb7       no
br-ce55c3cfefb5         8000.0242c21d4aba       no
docker0         8000.0242c661a50d       no
[root@doc11 ~]# ifconfig br-0f463941f2aa
br-0f463941f2aa: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 172.66.66.1  netmask 255.255.255.0  broadcast 172.66.66.255
        ether 02:42:6b:2b:8e:b7  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        æˆ‘ä»¬æ¥çœ‹çœ‹ç½‘ç»œæ€ä¹ˆä½¿ç”¨å§ï¼Œå¤§æ¦‚å¯ä»¥çŒœåˆ°æƒ³åˆ°ï¼Œä½¿ç”¨æ–¹æ³•å’Œä¸Šé¢çš„ç›¸åŒï¼Œä½¿ç”¨--networkå‚æ•°æŒ‡å®šç½‘ç»œã€‚ï¼ˆå› ä¸ºä½¿ç”¨çš„è™šæ‹Ÿæœºç¯å¢ƒæ¢å¤å¿«ç…§äº†ï¼Œé‡æ–°ä¸‹è½½äº†ä¸€ä¸‹busyboxï¼‰

[root@doc11 ~]# docker run -it --network=my_net2 busybox
Unable to find image 'busybox:latest' locally
latest: Pulling from library/busybox
5cc84ad355aa: Pull complete 
Digest: sha256:5acba83a746c7608ed544dc1533b87c737a0b0fb730301639a0179f9344b1678
Status: Downloaded newer image for busybox:latest
/ # ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
6: eth0@if7: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue 
    link/ether 02:42:ac:42:42:02 brd ff:ff:ff:ff:ff:ff
    inet 172.66.66.2/24 brd 172.66.66.255 scope global eth0
       valid_lft forever preferred_lft forever
/ # 
å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç½‘ç»œæ˜¯172.66.66.2/24ï¼Œä¹Ÿå¯ä»¥é€šè¿‡--ipæŒ‡å®šä¸€ä¸ªé™æ€ipã€‚

[root@doc11 ~]# docker run -it --network=my_net2 --ip 172.66.66.66 busybox
/ # ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
8: eth0@if9: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue 
    link/ether 02:42:ac:42:42:42 brd ff:ff:ff:ff:ff:ff
    inet 172.66.66.66/24 brd 172.66.66.255 scope global eth0
       valid_lft forever preferred_lft forever
æ³¨ï¼šåªæœ‰ä½¿ç”¨--subnetåˆ›å»ºçš„ç½‘ç»œæ‰èƒ½æŒ‡å®šé™æ€ipã€‚
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œå¤§è™¾å¥½åƒå—ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_61116007/article/details/131287350
